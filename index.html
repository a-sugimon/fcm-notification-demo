<!DOCTYPE html>
<html>
<head>
  <title>FCM Sample</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
    import { getMessaging, getToken, onMessage } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-messaging.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCHXDvCgn1JLfJokiMflPPhu5n5CSOyw2w",
      authDomain: "fcm-notification-demo-71005.firebaseapp.com",
      projectId: "fcm-notification-demo-71005",
      messagingSenderId: "239882082991",
      appId: "1:239882082991:web:4cbf27e851da2ee044525a",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);

    // サービスワーカーの登録
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/fcm-notification-demo/firebase-messaging-sw.js')
        .then(function(registration) {
          console.log('Service Worker registered with scope:', registration.scope);
        })
        .catch(function(error) {
          console.error('Service Worker registration failed:', error);
        });
    }

    document.getElementById("requestPermission").addEventListener("click", async () => {
      try {
        const permission = await Notification.requestPermission();
        if (permission === "granted") {
          const token = await getToken(messaging, {
            vapidKey: "BNiT4tuPxxwrW-co91OhdJUuIrBLqggjq-O1IVMdmZMvYOdYY7XSmvWnYFagLMVUrSU9dL798SP_RBFX8z1GIJ4",
          });
          console.log("取得したトークン:", token);
          // このトークンをサーバーに送って通知対象にする
        } else {
          console.warn("通知の許可がされていません");
        }
      } catch (err) {
        console.error("トークンの取得エラー:", err);
      }
    });

    // 通知を受け取る
    onMessage(messaging, (payload) => {
      console.log("通知受信:", payload);
      new Notification(payload.notification.title, {
        body: payload.notification.body,
        icon: payload.notification.icon,
      });
    });
  </script>
</head>
<body>
  <h1>Push通知テスト</h1>
  <button id="requestPermission">通知を許可</button>
</body>
</html>
